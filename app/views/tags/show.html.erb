<div id = "center-pane">
	<h2>Tag Profile</h2>

	<p>Tag Title: <%= @tag.title %><br>
		Latitude: <span id = "lat_span"><%= @tag.lat.to_s %></span><br>
		Longitude: <span id = "lng_span"><%= @tag.lng.to_s %></span><br>
		Radius: <span id = "radius_span"><%= @tag.radius.to_s %></span> meters</p>
	<br>
	<br>
	<%= link_to "Atlas Dashboard", atlas_path(params[:atlas_id]) %><br>
	<%= link_to "Tags for this atlas", atlas_tags_path(params[:atlas_id]) %>
</div>
<div id = "right-pane">
	<h2>Related Tags</h2>
	<%= render :partial => 'relations_table' %>
</div>
<div id = "bottom-right">
	<h2>Events At This Location</h2>
	<table>
		<thead>
			<th>Event</th>
			<th>Date Reported</th>
		</thead>
		<tbody>
			<% @events.each do |e| %>
				<tr><td><strong><%= e.name %><strong></td></tr>
				<% e.reports.each do |r| %>
					<%- if r.tag_id == @tag.id %>
						<tr>
							<td><em>Report:</em></td>
							<td><%= r.created_at.strftime("%B %d, %Y, %k:%M:%S %p") %></td>
						</tr>
					<%- end %>
				<%- end %>
			<% end %>
		</tbody>
	</table>
</div>
<div id = "map-holder">
	<div id = "map-canvas"></div>
</div>

<script type="text/javascript">
	function initialize() {
		
		// Setting up the map parameters based on what tags we're mapping.
		var tagsArray = [];
		var highLat = 0;
		var lowLat = 0;
		var highLng = 0;
		var lowLng = 0;
		var tagCount = Number($("#tag_count").val());
		for (var i=0; i<=tagCount; i++){
			tagHash = {};
			tagHash['lat'] = Number($("#lat" + String(i)).val());
			if(tagHash['lat'] > highLat){
				highLat = tagHash['lat'];
			}
			if(tagHash['lat'] < lowLat){
				lowLat = tagHash['lat'];
			}
			tagHash['lng'] = Number($("#lng" + String(i)).val());
			if(tagHash['lng'] > highLng){
				highLng = tagHash['lng'];
			}
			if(tagHash['lng'] < highLng){
				lowLng = tagHash['lng'];
			}
			tagHash['radius'] = Number($("#radius" + String(i)).val());
			tagHash['title'] = $("#title" + String(i)).val();
			tagHash['type'] = $("#type" + String(i)).val();
			tagsArray[i] = tagHash;
		}
		var NE = new google.maps.LatLng(latHigh, lngHigh);
		var SW = new google.maps.LatLng(latLow, lngLow);
		var mapScope = new google.maps LatLngBounds(SW, NE);
		var	markerPoint = mapScope.getCenter();


		var radiusDefault = Number($("#radius_span").text());
	  var mapOptions = {
	    center: markerPoint,
	    zoom: 8,
	    mapTypeId: google.maps.MapTypeId.HYBRID
	  };
	  var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);
		function addMarker(){
			marker = new google.maps.Marker({
				map:map,
				draggable:false,
				position:markerPoint,
				animation: null
			});
			markerCircle = new google.maps.Circle({
				map:map,
				center:markerPoint,
				radius:radiusDefault,
				fillColor:"#EEEEEE",
				fillOpacity:0.5,
				strokeColor:"#EEEEEE",
				strokeOpacity:1.0
			});
		};
		addMarker();

	};

	google.maps.event.addDomListener(window, 'load', initialize);


</script>


