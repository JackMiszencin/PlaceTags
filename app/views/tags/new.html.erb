<script type="text/javascript">
	function initialize() {
		var radiusDefault = Number($("#tag_radius").val());
	  var mapOptions = {
	    center: new google.maps.LatLng(-34.397, 150.644),
	    zoom: 8,
	    mapTypeId: google.maps.MapTypeId.HYBRID
	  };
	  var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);
		function addMarker(event){
			markerPoint = event.latLng
			marker = new google.maps.Marker({
				map:map,
				draggable:true,
				position:markerPoint,
				animation: null
			});
			markerCircle = new google.maps.Circle({
				map:map,
				center:markerPoint,
				radius:radiusDefault,
				fillColor:"#EEEEEE",
				fillOpacity:0.5,
				strokeColor:"#EEEEEE",
				strokeOpacity:1.0
			});
			function recenterCircle(){
				var newLatLng = marker.getPosition();
				markerCircle.setCenter(newLatLng);
				$("#tag_lat").val(newLatLng.lat());
				$("#tag_lng").val(newLatLng.lng());				
			};
			google.maps.event.addListener(marker, 'drag', recenterCircle)
			var lat = markerPoint.lat();
			var lng = markerPoint.lng();
			$("form").prepend("<input type = 'hidden' id = 'tag_lat' name = 'tag[lat]' value = " + lat + " >");
			$("form").prepend("<input type = 'hidden' id = 'tag_lng' name = 'tag[lng]' value = " + lng + " >");
			$("#tag_radius").on("click", function(){
				newRadius = Number($(this).val());
				markerCircle.setRadius(newRadius);
			});
			$("#tag_radius").on("keyup", function(){
				rFeed = String($(this).val());
				newRadius = Number(rFeed);
				markerCircle.setRadius(newRadius);
			});
		};
		google.maps.event.addListenerOnce(map, 'click', addMarker);
	};

	google.maps.event.addDomListener(window, 'load', initialize);


</script>
<div id = "map-holder">
	<div id = "map-canvas"></div>
</div>
	<div id="right-side">
		<%= form_for [@atlas, @tag] do |f| %>
			<div class = "control-group">
				<%= f.label :title, :class => 'control-label' %>
				<div class="controls">
					<%= f.text_field :title, :class => 'text_field' %>
				</div>
			</div>
			<div class = "control-group">
				<%= f.label :radius, :class => 'control-label' %>
				<div class="controls">
					<%= f.number_field :radius, :in => 0 ... 50000, :step => 0.5, :value => 100, :class => 'number_field' %>
				</div>
			</div>
			<%= f.submit "Create Tag" %>
		<% end %>
	</div>
